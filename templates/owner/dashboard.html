{% extends "base.html" %}
{% block content %}

<div class="mx-auto max-w-5xl px-6 py-10">

  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-8">
    <h2 class="text-2xl font-semibold tracking-tight">
      Owner Dashboard
    </h2>

    <button onclick="document.getElementById('addForm').classList.toggle('hidden')"
      class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-5 py-2.5 rounded-lg font-medium hover:shadow-md hover:scale-[1.01] active:scale-[0.99] transition">
      Add Customer
    </button>
  </div>

  <!-- Filter Tabs -->
  <div class="flex flex-wrap gap-3 mb-10">

    <a href="/owner/dashboard?filter=active"
       class="px-4 py-2 rounded-lg text-sm font-medium border
       {% if current_filter == 'active' %}
         bg-indigo-600 text-white border-indigo-600
       {% else %}
         bg-white text-gray-700 border-gray-300 hover:bg-gray-100
       {% endif %}">
      Active ({{ active_count }})
    </a>

    <a href="/owner/dashboard?filter=all"
       class="px-4 py-2 rounded-lg text-sm font-medium border
       {% if current_filter == 'all' %}
         bg-indigo-600 text-white border-indigo-600
       {% else %}
         bg-white text-gray-700 border-gray-300 hover:bg-gray-100
       {% endif %}">
      All ({{ total_count }})
    </a>

    <a href="/owner/dashboard?filter=inactive"
       class="px-4 py-2 rounded-lg text-sm font-medium border
       {% if current_filter == 'inactive' %}
         bg-indigo-600 text-white border-indigo-600
       {% else %}
         bg-white text-gray-700 border-gray-300 hover:bg-gray-100
       {% endif %}">
      Inactive ({{ inactive_count }})
    </a>

  </div>

  <!-- Add Form -->
  <div id="addForm" class="hidden mb-10 bg-white border border-gray-200 rounded-2xl shadow-sm p-8">
    <form method="POST" action="/owner/add-customer" class="space-y-5">

      <input name="name"
             placeholder="Customer Name"
             autocomplete="off"
             class="w-full border border-gray-300 rounded-lg px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500"
             required>

      <input name="phone"
             placeholder="Phone Number"
             class="w-full border border-gray-300 rounded-lg px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500"
             required>

      <input name="pin"
             placeholder="Set 4-digit PIN (optional)"
             class="w-full border border-gray-300 rounded-lg px-4 py-3 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500">

      <button class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3.5 rounded-lg font-medium hover:shadow-md hover:scale-[1.01] transition">
        Add Customer
      </button>

    </form>
  </div>

  <!-- Customer List -->
  {% if customers|length == 0 %}
    <p class="text-center text-gray-500 py-16">
      No customers found.
    </p>
  {% else %}
    <div class="space-y-5">
      {% for c in customers %}
      <div class="bg-white border border-gray-200 rounded-2xl p-6 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-6 shadow-sm hover:shadow-md transition">

        <!-- Left -->
        <div>
          <p class="font-medium text-gray-900">
            {{ c["name"] }}
          </p>

          <div class="mt-3">

            <!-- Phone View -->
            <div id="phone-view-{{ c['customer_id'] }}"
                 class="flex items-center gap-3 text-sm text-gray-500">

              <span>{{ c["phone"] }}</span>

              <button onclick="toggleEdit('{{ c.customer_id }}')"
                      class="text-xs px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-100 transition">
                ‚úè Edit
              </button>
            </div>

            <!-- Edit Mode -->
            <form method="POST"
                  action="/owner/update-customer-phone/{{ c['customer_id'] }}"
                  id="phone-edit-{{ c['customer_id'] }}"
                  class="hidden flex items-center gap-3 mt-3">

              <input name="phone"
                     value="{{ c['phone'] }}"
                     maxlength="10"
                     class="text-sm border border-gray-300 rounded-lg px-3 py-2 bg-white w-40 focus:ring-2 focus:ring-indigo-500"
                     required>

              <button class="text-xs px-3 py-1 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                Save
              </button>

              <button type="button"
                      onclick="toggleEdit('{{ c.customer_id }}')"
                      class="text-xs px-3 py-1 border border-gray-300 rounded-lg">
                Cancel
              </button>

            </form>

          </div>
        </div>

        <!-- Right Actions -->
        <div class="flex flex-wrap items-center gap-3">

          <!-- Active Badge -->
          <a href="/owner/toggle/{{ c['id'] }}"
             class="px-3 py-1 rounded-full text-xs font-medium
               {% if c['is_active'] %}
                 bg-green-100 text-green-700
               {% else %}
                 bg-gray-200 text-gray-600
               {% endif %}">
            {% if c['is_active'] %}Active{% else %}Inactive{% endif %}
          </a>

          <!-- View -->
          <a href="/transactions/{{ c['customer_id'] }}"
             class="px-4 py-2 border border-gray-300 rounded-lg text-sm hover:bg-gray-100 transition">
            View
          </a>

          <!-- Add -->
          <a href="/add-transaction/{{ c['customer_id'] }}"
             class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm hover:bg-indigo-700 transition">
            Add
          </a>

          <!-- DELETE (Only visible in inactive tab) -->
          {% if not c['is_active'] and current_filter == 'inactive' %}
          <a href="/owner/delete/{{ c['id'] }}"
             onclick="return confirm('Permanently delete this customer?')"
             class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 transition">
            Delete
          </a>
          {% endif %}

        </div>

      </div>
      {% endfor %}
    </div>
  {% endif %}

</div>

<script>
  function toggleEdit(id) {
    const view = document.getElementById("phone-view-" + id);
    const edit = document.getElementById("phone-edit-" + id);
    view.classList.toggle("hidden");
    edit.classList.toggle("hidden");
  }
</script>

{% endblock %}
